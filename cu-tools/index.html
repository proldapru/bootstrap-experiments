<!DOCTYPE html>
<html lang="ru">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Азбука</title>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js" integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js"></script>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
	<link rel="stylesheet" href="https://slavonic.github.io/css/fonts.css" type="text/css">
	<style type="text/css">
		/* Шрифты */
		body.font-Ponomar-Unicode td, body.font-Ponomar-Unicode .cu {
			font-family: 'Ponomar Unicode';
		}

		table td, table .cu {
			font-size: x-large;
		}

		table th {
			text-align: center;
			vertical-align: middle;
		}

		table th u {
			display: block;
			text-decoration: none;
			font-weight: normal;
			font-size: small;
			cursor: default;
			user-select: none;
		}

		table td {
			text-align: center;
			vertical-align: middle;
			cursor: default;
			user-select: none;
		}

		table td:hover, table th u:hover {
			background: #e2e3e5;
		}

		table.vowels td {
			width: 8%;
		}

		table.vowels2 td {
			width: 12%;
		}

		.red {
			color: red;
		}
/*consonants
combinations*/ 
	</style>
</head>
<body class="font-Ponomar-Unicode">
<div class="container">
	<h1 class="py-3">Инструменты для работы с церковнославянскими текстами</h1>
	<div class="accordion" id="appSections">
		<div class="accordion-item">
			<h2 class="accordion-header" id="heading1">
				<button class="accordion-button fs-3" type="button" data-bs-toggle="collapse" data-bs-target="#collapse1" aria-expanded="true" aria-controls="collapse1">Определение кодов Unicode</button>
			</h2>
			<div id="collapse1" class="accordion-collapse collapse show" aria-labelledby="heading1" data-bs-parent="#appSections">
				<div class="accordion-body">
					<div class="input-group input-group-lg mb-3">
						<input id="codesTestedText" type="text" class="form-control cu" placeholder="Изучаемый текст" aria-label="Изучаемый текст" aria-describedby="button-addon2" autocomplete="off" value="Хрⷭ҇то́съ воскре́се!">
						<button id="codesShowBtn" class="btn btn-outline-secondary" type="button" id="button-addon2">Показать коды</button>
					</div>
					<div id="codesViewContainer" class="alert alert-secondary text-break" role="alert">&nbsp;</div>
				</div>
			</div>
		</div>

		<div class="accordion-item">
			<h2 class="accordion-header" id="heading2">
				<button class="accordion-button fs-3 collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse2" aria-expanded="false" aria-controls="collapse2">Гласные буквы</button>
			</h2>
			<div id="collapse2" class="accordion-collapse collapse" aria-labelledby="heading2" data-bs-parent="#appSections">
				<div class="accordion-body">
				    <h4>Общие случаи</h4>
					<p class="pb-0">Для копирования в буфер обмена нажмите на букву или номер Unicode-кода.</p>
					<table class="table table-bordered vowels">
						<thead>
							<tr>
								<th scope="col">Название</th>
								<th scope="col">Буква</th>
								<!-- <th scope="col">Ти́тло<u>0483</u></th> -->
								<th scope="col"><abbr title="Острое ударение">Окси́я</abbr><u>0301</u></th>
								<th scope="col"><abbr title="Тяжелое ударение">Вари́я</abbr><u>0300</u></th>
								<th scope="col"><abbr title="Облегченное ударение">Камо́ра</abbr><u>0311</u></th>
								<th scope="col"><abbr title="Тонкое придыхание">Зва́тельцо</abbr><u>0486</u></th>
								<th scope="col"><abbr title="Зва́тельцо + Окси́я">И́со</abbr><u>0486+0301</u></th>
								<th scope="col"><abbr title="Зва́тельцо + Вари́я">Апостро́ф</abbr><u>0486+0300</u></th>
								<th scope="col"><abbr title="Густое придыхание">Даси́я</abbr><u>0485</u></th>
							</tr>
						</thead>
						<tbody></tbody>
					</table>
				    <h4>Специальные случаи</h4>
					<p class="pb-0">Для копирования в буфер обмена нажмите на букву или номер Unicode-кода.</p>
					<table class="table table-bordered vowels2">
						<thead>
							<tr>
								<th scope="col">Название</th>
								<th scope="col">Буква</th>
								<th scope="col">Кра́тка<u>0306</u></th>
								<th scope="col"><abbr title="Острое ударение">Окси́я</abbr><u>0301</u></th>
								<th scope="col"><abbr title="Тонкое придыхание">Зва́тельцо</abbr><u>0486</u></th>
								<th scope="col"><abbr title="Зва́тельцо + Окси́я">И́со</abbr><u>0486+0301</u></th>
								<th scope="col"><abbr title="Кенде́ма">Смыче́ц</abbr><u>030F</u></th>
							</tr>
						</thead>
						<tbody></tbody>
					</table>
				</div>
			</div>
		</div>
<!--
		<div class="accordion-item">
			<h2 class="accordion-header" id="heading3">
				<button class="accordion-button fs-3 collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse3" aria-expanded="false" aria-controls="collapse3">Accordion Item #3</button>
			</h2>
			<div id="collapse3" class="accordion-collapse collapse" aria-labelledby="heading3" data-bs-parent="#appSections">
				<div class="accordion-body">
				</div>
			</div>
		</div>
	</div>
-->

</div>


<div class="toast position-fixed top-0 end-0 m-3 align-items-center bg-success bg-gradient text-white border-0" role="alert" aria-live="assertive" aria-atomic="true">
	<div class="toast-body fs-5"></div>
</div>


<script type="text/javascript">
	let specCharNames = {
		'0020':'пробел',
		'00ad':'мягкий перенос',
		'0300':'вария',
		'0301':'оксия',
		'0306':'кратка',
		'030F':'смычец',
		'0311':'камора',
		'0483':'титло',
		'0485':'дасия',
		'0486':'звательцо'
	};
	let letters = {
		vowels: [
			{name:'а҆́зъ',  tr:'а', unicode:['0410', '0430'], dm:'all'},
			{name:'є҆́сть', tr:'е', unicode:['0415', '0435'], dm:'all'},
			{name:'є҆́сть широ́кое', tr:'е', unicode:['0404', '0454'], dm:'all'},
			{name:'ꙗ҆́ть', tr:'е', unicode:['0462', '0463'], dm:'all'},
			{name:'и҆́же', tr:'и', unicode:['0418', '0438'], dm:'all'},
			{name:'и҆̀', tr:'и', unicode:['0407', '0457'], unicode2:['0406', '0456'], dm:'all'},
			{name:'ѻ҆́нъ', tr:'о', unicode:['041E', '043E'], dm:'all'},
			{name:'ѻ҆́нъ широ́кий', tr:'о', unicode:['047A', '047B'], dm:'all'},
			{name:'ѡ҆ме́га', tr:'о', unicode:['0460', '0461'], dm:'all'},
			{name:'ѻ҆́никъ', tr:'у', unicode:['0478', '0479'], dm:'all'},
			{name:'ѹ҆́​къ', tr:'у', unicode:['A64A', 'A64B'], dm:'all'},
			{name:'є҆ры̀', tr:'ы', unicode:['042B', '044B'], dm:'all'},
			{name:'ю҆̀', tr:'ю', unicode:['042E', '044E'], dm:'all'},
			{name:'ꙗ҆̀', tr:'я', unicode:['A656', 'A657'], dm:'all'},
			{name:'ю҆́съ ма́лый', tr:'я', unicode:['0466', '0467'], dm:'all'}
		],
		vowels2: [
		    {name:'и҆́же кра́ткое', tr:'й', unicode:['0418+0306', '0438+0306'], unicode2:['0418', '0438'], comment:'Буква и҆́же с покрытием кра́тка', dm:'10000'},
		    {name:'ѡ҆́тъ', tr:'от', unicode:['047E', '047F'], comment:'Лигатура ѡ҆ме́га + тве́рдо', dm:'none'},
		    {name:'ѡ҆ме́га торжестве́нная', tr:'о', unicode:['047C', '047D'], comment:'Вариант напрсания буквы ѡ҆ме́га', dm:'none'},
		    {name:'ѵ҆́жица', tr:['в', 'и'], unicode:['0474', '0475'], comment:'Без покрытия произносится [в], с покрытием — [и]' , dm:'01111'}
		]
//		consonants: [],
//		combinations: [] 
	};
	$(document).ready(function() {
		let message = new bootstrap.Toast($('.toast')[0], {delay: 2000});
		/* Определитель Unicode-кодов */
		$('#codesShowBtn').on('click', function(ev) {
			let t = $('#codesTestedText').val();
			$('#codesViewContainer').html(t ? t.split('').map(x=>{let c = ('000' + x.charCodeAt(0).toString(16)).substr(-4); return `<abbr${ specCharNames[c] ? ` class="red"` : '' } title="${ specCharNames[c] || x }">${c}</abbr>`;}).join('+') : '&nbsp;');
		});
		
		/* Обработка таблицы с буквами */
		for(letterType in letters) {
			// Получим заданные в заголовке HTML-таблицы юникод-коды диакритических знаков
			let tableDM = $(`table.${letterType} thead th u`).map(function(){
				let txt = $(this).text()
				return ~txt.indexOf('+') ? `&#x${ txt.split('+').join(';&#x') };` : `&#x${txt};`;
			}).get();

			// Сформируем таблицу букв с диакритическими знаками
			for(let l of letters[letterType]) {
				let tableRows = [
					// первая строка с заголовком <th scope="row" rowspan="2">
					`<tr><th scope="row" rowspan="2"><abbr class="cu"${ l.comment ? ` title="${l.comment}"` : '' }>${l.name}</abbr> [${ typeof(l.tr)=='string' ? l.tr : l.tr.join('], [')}]<u>${l.unicode[0]}</u><u>${l.unicode[1]}</u></th>`,
					// пустая заготовка под вторую строку
					'<tr>'
				];

				for(let r of [0, 1]) {
					let htmlCode = ~l.unicode[r].indexOf('+') ? `&#x${ l.unicode[r].split('+').join(';&#x') };` : `&#x${l.unicode[r]};`;
					// В первой ячейке сама буква без диакритических знаков
					tableRows[r] +=`<td>${htmlCode}</td>`;
					// Если для других ячеек задан отдельный unicode-код
					if(l.unicode2)
						htmlCode = ~l.unicode2[r].indexOf('+') ? `&#x${ l.unicode2[r].split('+').join(';&#x') };` : `&#x${l.unicode2[r]};`;
					// Ячейки с буквой и диакритическими знаками
					if(l.dm=='all')
						tableRows[r] +=`<td>${ tableDM.map(x=>htmlCode + x).join(`</td><td>`) }</td></tr>`;
					else if(l.dm=='none')
						tableRows[r] +=`<td>${ tableDM.map(x=>'').join(`</td><td>`) }</td></tr>`;
					else
						tableRows[r] +=`<td>${ l.dm.split('').map((x, ind)=>x==='1' ? htmlCode + tableDM[ind] :'').join(`</td><td>`) }</td></tr>`;
				}
				$(`table.${letterType} tbody`).append(tableRows);
			}
		}

		// Инициализация Clipboard.js
		let cb1 = new ClipboardJS('table tbody td', {
			text: function(el) {
				return el.innerText;
			}
		});

		cb1.on('success', function (e) {
			$('.toast-body').text(`Скопировано: ${e.text}`);
			message.show();
		});

		let cb2 = new ClipboardJS('table th u', {
			text: function(el) {
				let txt = el.innerText
				return ~txt.indexOf('+') ? `&#x${ txt.split('+').join(';&#x') };` : `&#x${txt};`;
			}
		});

		cb2.on('success', function (e) {
			$('.toast-body').text(`Скопировано: ${e.text}`);
			message.show();
		});
	});
</script>
</body>
</html>
